@page
@{
    ViewData["Title"] = "Consolidado de Pagos";
}

@(Html.DevExtreme().PivotGrid<ViewPagosAsignaciones>()
    .ID("pivot").Height(800)
    .DataSource(c=>c.Store(m=>m.Mvc().Controller("Pagos").LoadAction("GetAll"))
                    .Fields(c=>
                    {
                        c.AddFor(m => m.DatoCompleto).Area(PivotGridArea.Row).Width(200);
                        c.AddFor(m => m.MesPagadoFecha).Format("MMMM/yyyy").Area(PivotGridArea.Column);
                        c.AddFor(m => m.TotalRecibo).Area(PivotGridArea.Data).SummaryType(SummaryType.Sum).RunningTotal(PivotGridRunningTotalMode.Row);
                        c.AddFor(m => m.NombreProyecto).Area(PivotGridArea.Filter);

                    })
                    .Paginate(true).RetrieveFields(false).Filter("[['MesPagado', '<>', null]]")
    )

    .HeaderFilter(c=>c.AllowSearch(true).Height(200).ShowRelevantValues(true))
    .FieldPanel(c=>c.Visible(true).ShowFilterFields(true).AllowFieldDragging(false))
    .AllowFiltering(true)
    .ShowTotalsPrior(PivotGridTotalsDisplayMode.Columns).ShowRowTotals(false)
    .Scrolling(c=>c.Mode(PivotGridScrollingMode.Virtual))
    .Width("100%").ShowBorders(true)
    .Texts(c=>c.GrandTotal("Total Abonado"))
    .Export(c=>c.Enabled(true))//.OnExporting("exporting")
    )

<script>



    function exporting(e) {
        var workbook = new ExcelJS.Workbook();
        var worksheet = workbook.addWorksheet('Main sheet');
        DevExpress.excelExporter.exportPivotGrid({
            worksheet: worksheet,
            component: e.component,
            customizeCell: function (options) {
                var excelCell = options;
                excelCell.font = { name: 'Arial', size: 12 };
                excelCell.alignment = { horizontal: 'left' };
            }
        }).then(function () {
            workbook.xlsx.writeBuffer().then(function (buffer) {
                saveAs(new Blob([buffer], { type: 'application/octet-stream' }), 'PivotGrid.xlsx');
            });
        });
        e.cancel = true;
    }
</script>







